pipeline {
	agent any
	parameters
	{
		booleanParam(name: 'LinuxARM', defaultValue: true, description: '') 
		booleanParam(name: 'LinuxX86', defaultValue: true, description: '') 
		booleanParam(name: 'Win', defaultValue: true, description: '') 
		booleanParam(name: 'Mac', defaultValue: true, description: '')
		//string(name: 'Branch', defaultValue: "master", description: '')
		choice(name: 'Branch', choices: ['master', 'snow'], description: '')
		booleanParam(name: 'IntegrationTest', defaultValue: true, description: '')
		booleanParam(name: 'Deploy', defaultValue: true, description: '')
	}
	stages {
		stage('Parallel Build') {
			parallel {
				stage('Windows') {
					when { expression { return params.Win } }
					steps {
						startBuildJob('win')
					}
				}
				stage('Mac') {
					when { expression { return params.Mac } }
					steps {
						startBuildJob('mac')
					}
				}
				stage('Linux aarch64') {
					when { expression { return params.LinuxARM } }
					steps {
						startBuildJob('linux && arm')
					}
				}
				stage('Linux x86') {
					when { expression { return params.LinuxX86 } }
					steps {
						startBuildJob('linux && x86')
					}
				}
			}
		}
	}
}

def startBuildJob(label)
{
//	  build job: 'dsp56300', parameters: [[$class: 'LabelParameterValue', name: 'Agent', label: "win" ]]
	build job: 'dsp56300', parameters:
	[
		[$class: 'StringParameterValue', name: 'AgentLabel', value: "${label}"], 
		[$class: 'StringParameterValue', name: 'Branch', value: params.Branch], 
		[$class: 'BooleanParameterValue', name: 'Deploy', value: Boolean.valueOf(params.Deploy)], 
		[$class: 'BooleanParameterValue', name: 'IntegrationTests', value: Boolean.valueOf(params.IntegrationTest)]
	]
}
